<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Usual problems encountered when using lcmm package</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Usual problems encountered when using lcmm package</h1>


<div id="TOC">
<ul>
<li><a href="#why-my-model-did-not-converge">Why my model did not converge?</a></li>
<li><a href="#how-to-choose-the-number-of-latent-classes">How to choose the number of latent classes?</a></li>
<li><a href="#how-to-evaluate-the-quality-of-a-classification">How to evaluate the quality of a classification ?</a></li>
<li><a href="#how-to-evaluate-the-fit-of-a-model">How to evaluate the fit of a model ?</a></li>
<li><a href="#how-to-pre-normalize-a-variable-using-lcmm">How to pre-normalize a variable using lcmm ?</a></li>
<li><a href="#how-to-change-the-latent-class-in-reference">How to change the latent class in reference?</a></li>
<li><a href="#how-to-make-predictions-on-external-data">How to make predictions on external data?</a></li>
</ul>
</div>

<p> </p>
<p>We list here some recurrent problems reported by users. Other issues, questions, concerns may have been reported in github: <a href="https://github.com/CecileProust-Lima/lcmm/issues/" class="uri">https://github.com/CecileProust-Lima/lcmm/issues/</a> .</p>
<p><strong>Please refer to github, both closed and opened issues, before sending any question. And please ask the questions via github only.</strong></p>
<p> </p>
<div id="why-my-model-did-not-converge" class="section level1">
<h1>Why my model did not converge?</h1>
<p>It sometimes happens that a model does not converge correctly. This is due most of the time to the very stringent criterion based on the “derivatives”. This criterion uses both the first derivatives and the inverse of the matrix of the second derivatives (Hessian). It ensures that the program converges at a maximum. When it can’t be computed correctly (most of the time because the Hessian is not definite positive), the program reports “second derivatives = 1”.</p>
<p><strong>There are several reasons that may induce a non convergence, e.g.:</strong></p>
<ol style="list-style-type: decimal">
<li><p>When the time variable (or more generally a variable with random effects) is in a unit which induces too small associated parameters (for very small changes per day). In that case, changing the scale (for instance with months or years) may solve the problem.</p></li>
<li><p>In models with splines in the link function (lcmm, multlcmm, Jointlcmm) or with splines in the baseline risk function (Jointlcmm), a parameter associated with splines very close to zero may prevent for correct convergence as it is at the border of the parameter space. In that case, this parameter can be fixed to 0 and convergence should be reached immediately.</p></li>
<li>When the data are not rich enough and/or the model is too complicated. In that case, this is a problem of numerical non identifiability. There are not many solutions (other than simplifying the model) but some directions may be :
<ul>
<li>Be patient, it happens that after some iterations the derivatives might be inversible and the model converges (you can change maxiter or rerun the program from the estimates at the non convergence point). But this is usually no necessary to specify more than 100 or 200 iterations. The iterative algorithm is used to converge in a few dozen of iterations.</li>
<li>You can try to assume a less stringent threshold (e.g., 0.01) but be careful, convergence might be of lower quality.<br />
</li>
<li>Run the model from different initial values.</li>
</ul></li>
</ol>
<p> </p>
</div>
<div id="how-to-choose-the-number-of-latent-classes" class="section level1">
<h1>How to choose the number of latent classes?</h1>
<p>Selection of the number of latent classes is a complex question. In some cases, the number is known. When not, different tools can be used to guide the decision:</p>
<ul>
<li>Several statistical criteria such as BIC, SABIC, ICL or Entropy</li>
<li>Statistical tests when available: score test for conditional independence in joint models</li>
<li>Discrimination power as described by the classification table using the command postprob</li>
<li>Size of the classes (we can consider that classes should be larger than 1% or 5% depending on the context)</li>
<li>Clinical aspects and interpretation should also be taken into account</li>
</ul>
<p>Finally, it can be useful to present and contrast models with different numbers of latent classes.</p>
<p>The complexity of the selection of the optimal number of latent classes is illustrated in vignette: <a href="https://cran.r-project.org/package=lcmm/vignettes/latent_class_model_with_hlme.html" class="uri">https://cran.r-project.org/package=lcmm/vignettes/latent_class_model_with_hlme.html</a> . Indeed, all the criteria may not be concordant in practice.</p>
<p> </p>
</div>
<div id="how-to-evaluate-the-quality-of-a-classification" class="section level1">
<h1>How to evaluate the quality of a classification ?</h1>
<p>Good discrimination of classes is usually sought when fitting latent class mixed models. Discriminatory power can be assessed using the entropy criterion (provided in summarytable) but also using the classification table (with command postprob). The description of the classes may also help comprehend the latent class structure.</p>
<p>(see vignette <a href="https://cran.r-project.org/package=lcmm/vignettes/latent_class_model_with_hlme.html" class="uri">https://cran.r-project.org/package=lcmm/vignettes/latent_class_model_with_hlme.html</a> for further details)</p>
<p> </p>
</div>
<div id="how-to-evaluate-the-fit-of-a-model" class="section level1">
<h1>How to evaluate the fit of a model ?</h1>
<p>Different techniques can be used in this package to evaluate the goodness of fit. As in mixed models, one can compare the subject-specific predictions with the observations or plot the subject-specific residuals.</p>
<p>The comparison with more flexible models can also be useful (more flexible link functions, more flexible baseline risk functions, more flexible functions of time, etc.)</p>
<p>Each vignette includes a section on the evaluation of the model.</p>
<p> </p>
</div>
<div id="how-to-pre-normalize-a-variable-using-lcmm" class="section level1">
<h1>How to pre-normalize a variable using lcmm ?</h1>
<p>This is detailed in vignette on pre-normalizing: <a href="https://cran.r-project.org/package=lcmm/vignettes/pre_normalizing.html" class="uri">https://cran.r-project.org/package=lcmm/vignettes/pre_normalizing.html</a></p>
<p> </p>
</div>
<div id="how-to-change-the-latent-class-in-reference" class="section level1">
<h1>How to change the latent class in reference?</h1>
<p>The order of the latent classes can be changed in any function (hlme, lcmm, Jointlcmm, mpjlcmm) using the permut function. Here is an example with the estimation of a two class linear mixed model:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">mhlme &lt;-<span class="st"> </span><span class="kw">hlme</span>(IST <span class="op">~</span><span class="st"> </span><span class="kw">I</span>(age<span class="op">-</span>age_init),<span class="dt">random=</span><span class="op">~</span><span class="st"> </span><span class="kw">I</span>(age<span class="op">-</span>age_init),<span class="dt">subject=</span><span class="st">&quot;ID&quot;</span>,<span class="dt">data=</span>paquid)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">set.seed</span>(<span class="dv">1234</span>)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">mhlme2 &lt;-<span class="st"> </span><span class="kw">hlme</span>(IST <span class="op">~</span><span class="st"> </span><span class="kw">I</span>(age<span class="op">-</span>age_init),<span class="dt">random=</span><span class="op">~</span><span class="st"> </span><span class="kw">I</span>(age<span class="op">-</span>age_init),<span class="dt">subject=</span><span class="st">&quot;ID&quot;</span>,<span class="dt">data=</span>paquid,<span class="dt">ng=</span><span class="dv">2</span>,</a>
<a class="sourceLine" id="cb1-4" data-line-number="4">               <span class="dt">mixture=</span><span class="op">~</span><span class="st"> </span><span class="kw">I</span>(age<span class="op">-</span>age_init),<span class="dt">classmb =</span><span class="op">~</span><span class="st"> </span>CEP , <span class="dt">B=</span><span class="kw">random</span>(mhlme))</a></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">summary</span>(mhlme2)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">Heterogenous linear mixed model </a>
<a class="sourceLine" id="cb2-3" data-line-number="3">     fitted by maximum likelihood method </a>
<a class="sourceLine" id="cb2-4" data-line-number="4"> </a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="kw">hlme</span>(<span class="dt">fixed =</span> IST <span class="op">~</span><span class="st"> </span><span class="kw">I</span>(age <span class="op">-</span><span class="st"> </span>age_init), <span class="dt">mixture =</span> <span class="op">~</span><span class="kw">I</span>(age <span class="op">-</span><span class="st"> </span>age_init), </a>
<a class="sourceLine" id="cb2-6" data-line-number="6">    <span class="dt">random =</span> <span class="op">~</span><span class="kw">I</span>(age <span class="op">-</span><span class="st"> </span>age_init), <span class="dt">subject =</span> <span class="st">&quot;ID&quot;</span>, <span class="dt">classmb =</span> <span class="op">~</span>CEP, </a>
<a class="sourceLine" id="cb2-7" data-line-number="7">    <span class="dt">ng =</span> <span class="dv">2</span>, <span class="dt">data =</span> paquid)</a>
<a class="sourceLine" id="cb2-8" data-line-number="8"> </a>
<a class="sourceLine" id="cb2-9" data-line-number="9">Statistical Model<span class="op">:</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10"><span class="st">     </span>Dataset<span class="op">:</span><span class="st"> </span>paquid </a>
<a class="sourceLine" id="cb2-11" data-line-number="11">     Number of subjects<span class="op">:</span><span class="st"> </span><span class="dv">494</span> </a>
<a class="sourceLine" id="cb2-12" data-line-number="12">     Number of observations<span class="op">:</span><span class="st"> </span><span class="dv">2052</span> </a>
<a class="sourceLine" id="cb2-13" data-line-number="13">     Number of observations deleted<span class="op">:</span><span class="st"> </span><span class="dv">198</span> </a>
<a class="sourceLine" id="cb2-14" data-line-number="14">     Number of latent classes<span class="op">:</span><span class="st"> </span><span class="dv">2</span> </a>
<a class="sourceLine" id="cb2-15" data-line-number="15">     Number of parameters<span class="op">:</span><span class="st"> </span><span class="dv">10</span>  </a>
<a class="sourceLine" id="cb2-16" data-line-number="16"> </a>
<a class="sourceLine" id="cb2-17" data-line-number="17">Iteration process<span class="op">:</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-18" data-line-number="18"><span class="st">     </span>Convergence criteria satisfied </a>
<a class="sourceLine" id="cb2-19" data-line-number="19">     Number of iterations<span class="op">:</span><span class="st">  </span><span class="dv">16</span> </a>
<a class="sourceLine" id="cb2-20" data-line-number="20">     Convergence criteria<span class="op">:</span><span class="st"> </span>parameters=<span class="st"> </span><span class="fl">1.2e-08</span> </a>
<a class="sourceLine" id="cb2-21" data-line-number="21">                         <span class="op">:</span><span class="st"> </span>likelihood=<span class="st"> </span><span class="fl">3.1e-09</span> </a>
<a class="sourceLine" id="cb2-22" data-line-number="22">                         <span class="op">:</span><span class="st"> </span>second derivatives=<span class="st"> </span><span class="fl">5.5e-15</span> </a>
<a class="sourceLine" id="cb2-23" data-line-number="23"> </a>
<a class="sourceLine" id="cb2-24" data-line-number="24">Goodness<span class="op">-</span>of<span class="op">-</span>fit statistics<span class="op">:</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-25" data-line-number="25"><span class="st">     </span>maximum log<span class="op">-</span>likelihood<span class="op">:</span><span class="st"> </span><span class="fl">-6010.69</span>  </a>
<a class="sourceLine" id="cb2-26" data-line-number="26">     AIC<span class="op">:</span><span class="st"> </span><span class="fl">12041.38</span>  </a>
<a class="sourceLine" id="cb2-27" data-line-number="27">     BIC<span class="op">:</span><span class="st"> </span><span class="fl">12083.4</span>  </a>
<a class="sourceLine" id="cb2-28" data-line-number="28"> </a>
<a class="sourceLine" id="cb2-29" data-line-number="29"> </a>
<a class="sourceLine" id="cb2-30" data-line-number="30">Maximum Likelihood Estimates<span class="op">:</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-31" data-line-number="31"><span class="st"> </span></a>
<a class="sourceLine" id="cb2-32" data-line-number="32">Fixed effects <span class="cf">in</span> the class<span class="op">-</span>membership model<span class="op">:</span></a>
<a class="sourceLine" id="cb2-33" data-line-number="33">(the class of reference is the last class) </a>
<a class="sourceLine" id="cb2-34" data-line-number="34"></a>
<a class="sourceLine" id="cb2-35" data-line-number="35">                     coef      Se    Wald p<span class="op">-</span>value</a>
<a class="sourceLine" id="cb2-36" data-line-number="36">intercept class1  <span class="fl">2.82685</span> <span class="fl">1.02130</span>   <span class="fl">2.768</span> <span class="fl">0.00564</span></a>
<a class="sourceLine" id="cb2-37" data-line-number="37">CEP class1       <span class="fl">-3.37139</span> <span class="fl">0.99981</span>  <span class="fl">-3.372</span> <span class="fl">0.00075</span></a>
<a class="sourceLine" id="cb2-38" data-line-number="38"></a>
<a class="sourceLine" id="cb2-39" data-line-number="39">Fixed effects <span class="cf">in</span> the longitudinal model<span class="op">:</span></a>
<a class="sourceLine" id="cb2-40" data-line-number="40"></a>
<a class="sourceLine" id="cb2-41" data-line-number="41"><span class="st">                             </span>coef      Se    Wald p<span class="op">-</span>value</a>
<a class="sourceLine" id="cb2-42" data-line-number="42">intercept class1         <span class="fl">25.54344</span> <span class="fl">0.49499</span>  <span class="fl">51.604</span> <span class="fl">0.00000</span></a>
<a class="sourceLine" id="cb2-43" data-line-number="43">intercept class2         <span class="fl">32.93897</span> <span class="fl">0.54794</span>  <span class="fl">60.115</span> <span class="fl">0.00000</span></a>
<a class="sourceLine" id="cb2-44" data-line-number="44"><span class="kw">I</span>(age <span class="op">-</span><span class="st"> </span>age_init) class1 <span class="fl">-0.51254</span> <span class="fl">0.05011</span> <span class="fl">-10.229</span> <span class="fl">0.00000</span></a>
<a class="sourceLine" id="cb2-45" data-line-number="45"><span class="kw">I</span>(age <span class="op">-</span><span class="st"> </span>age_init) class2 <span class="fl">-0.57198</span> <span class="fl">0.04883</span> <span class="fl">-11.714</span> <span class="fl">0.00000</span></a>
<a class="sourceLine" id="cb2-46" data-line-number="46"></a>
<a class="sourceLine" id="cb2-47" data-line-number="47"></a>
<a class="sourceLine" id="cb2-48" data-line-number="48">Variance<span class="op">-</span>covariance matrix of the random<span class="op">-</span>effects<span class="op">:</span></a>
<a class="sourceLine" id="cb2-49" data-line-number="49"><span class="st">                  </span>intercept <span class="kw">I</span>(age <span class="op">-</span><span class="st"> </span>age_init)</a>
<a class="sourceLine" id="cb2-50" data-line-number="50">intercept          <span class="fl">10.89147</span>                  </a>
<a class="sourceLine" id="cb2-51" data-line-number="51"><span class="kw">I</span>(age <span class="op">-</span><span class="st"> </span>age_init)   <span class="fl">0.03929</span>           <span class="fl">0.09386</span></a>
<a class="sourceLine" id="cb2-52" data-line-number="52"></a>
<a class="sourceLine" id="cb2-53" data-line-number="53">                             coef      Se</a>
<a class="sourceLine" id="cb2-54" data-line-number="54">Residual standard error<span class="op">:</span><span class="st">  </span><span class="fl">3.36817</span> <span class="fl">0.06754</span></a></code></pre></div>
<p>The order of the latent classes can be changed by running:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">mhlme2perm &lt;-<span class="st"> </span><span class="kw">permut</span>(mhlme2, <span class="dt">order=</span><span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">1</span>))</a></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">summary</span>(mhlme2)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2">Heterogenous linear mixed model </a>
<a class="sourceLine" id="cb4-3" data-line-number="3">     fitted by maximum likelihood method </a>
<a class="sourceLine" id="cb4-4" data-line-number="4"> </a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="kw">hlme</span>(<span class="dt">fixed =</span> IST <span class="op">~</span><span class="st"> </span><span class="kw">I</span>(age <span class="op">-</span><span class="st"> </span>age_init), <span class="dt">mixture =</span> <span class="op">~</span><span class="kw">I</span>(age <span class="op">-</span><span class="st"> </span>age_init), </a>
<a class="sourceLine" id="cb4-6" data-line-number="6">    <span class="dt">random =</span> <span class="op">~</span><span class="kw">I</span>(age <span class="op">-</span><span class="st"> </span>age_init), <span class="dt">subject =</span> <span class="st">&quot;ID&quot;</span>, <span class="dt">classmb =</span> <span class="op">~</span>CEP, </a>
<a class="sourceLine" id="cb4-7" data-line-number="7">    <span class="dt">ng =</span> <span class="dv">2</span>, <span class="dt">data =</span> paquid)</a>
<a class="sourceLine" id="cb4-8" data-line-number="8"> </a>
<a class="sourceLine" id="cb4-9" data-line-number="9">Statistical Model<span class="op">:</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="st">     </span>Dataset<span class="op">:</span><span class="st"> </span>paquid </a>
<a class="sourceLine" id="cb4-11" data-line-number="11">     Number of subjects<span class="op">:</span><span class="st"> </span><span class="dv">494</span> </a>
<a class="sourceLine" id="cb4-12" data-line-number="12">     Number of observations<span class="op">:</span><span class="st"> </span><span class="dv">2052</span> </a>
<a class="sourceLine" id="cb4-13" data-line-number="13">     Number of observations deleted<span class="op">:</span><span class="st"> </span><span class="dv">198</span> </a>
<a class="sourceLine" id="cb4-14" data-line-number="14">     Number of latent classes<span class="op">:</span><span class="st"> </span><span class="dv">2</span> </a>
<a class="sourceLine" id="cb4-15" data-line-number="15">     Number of parameters<span class="op">:</span><span class="st"> </span><span class="dv">10</span>  </a>
<a class="sourceLine" id="cb4-16" data-line-number="16"> </a>
<a class="sourceLine" id="cb4-17" data-line-number="17">Iteration process<span class="op">:</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-18" data-line-number="18"><span class="st">     </span>Convergence criteria satisfied </a>
<a class="sourceLine" id="cb4-19" data-line-number="19">     Number of iterations<span class="op">:</span><span class="st">  </span><span class="dv">16</span> </a>
<a class="sourceLine" id="cb4-20" data-line-number="20">     Convergence criteria<span class="op">:</span><span class="st"> </span>parameters=<span class="st"> </span><span class="fl">1.2e-08</span> </a>
<a class="sourceLine" id="cb4-21" data-line-number="21">                         <span class="op">:</span><span class="st"> </span>likelihood=<span class="st"> </span><span class="fl">3.1e-09</span> </a>
<a class="sourceLine" id="cb4-22" data-line-number="22">                         <span class="op">:</span><span class="st"> </span>second derivatives=<span class="st"> </span><span class="fl">5.5e-15</span> </a>
<a class="sourceLine" id="cb4-23" data-line-number="23"> </a>
<a class="sourceLine" id="cb4-24" data-line-number="24">Goodness<span class="op">-</span>of<span class="op">-</span>fit statistics<span class="op">:</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-25" data-line-number="25"><span class="st">     </span>maximum log<span class="op">-</span>likelihood<span class="op">:</span><span class="st"> </span><span class="fl">-6010.69</span>  </a>
<a class="sourceLine" id="cb4-26" data-line-number="26">     AIC<span class="op">:</span><span class="st"> </span><span class="fl">12041.38</span>  </a>
<a class="sourceLine" id="cb4-27" data-line-number="27">     BIC<span class="op">:</span><span class="st"> </span><span class="fl">12083.4</span>  </a>
<a class="sourceLine" id="cb4-28" data-line-number="28"> </a>
<a class="sourceLine" id="cb4-29" data-line-number="29"> </a>
<a class="sourceLine" id="cb4-30" data-line-number="30">Maximum Likelihood Estimates<span class="op">:</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-31" data-line-number="31"><span class="st"> </span></a>
<a class="sourceLine" id="cb4-32" data-line-number="32">Fixed effects <span class="cf">in</span> the class<span class="op">-</span>membership model<span class="op">:</span></a>
<a class="sourceLine" id="cb4-33" data-line-number="33">(the class of reference is the last class) </a>
<a class="sourceLine" id="cb4-34" data-line-number="34"></a>
<a class="sourceLine" id="cb4-35" data-line-number="35">                     coef      Se    Wald p<span class="op">-</span>value</a>
<a class="sourceLine" id="cb4-36" data-line-number="36">intercept class1  <span class="fl">2.82685</span> <span class="fl">1.02130</span>   <span class="fl">2.768</span> <span class="fl">0.00564</span></a>
<a class="sourceLine" id="cb4-37" data-line-number="37">CEP class1       <span class="fl">-3.37139</span> <span class="fl">0.99981</span>  <span class="fl">-3.372</span> <span class="fl">0.00075</span></a>
<a class="sourceLine" id="cb4-38" data-line-number="38"></a>
<a class="sourceLine" id="cb4-39" data-line-number="39">Fixed effects <span class="cf">in</span> the longitudinal model<span class="op">:</span></a>
<a class="sourceLine" id="cb4-40" data-line-number="40"></a>
<a class="sourceLine" id="cb4-41" data-line-number="41"><span class="st">                             </span>coef      Se    Wald p<span class="op">-</span>value</a>
<a class="sourceLine" id="cb4-42" data-line-number="42">intercept class1         <span class="fl">25.54344</span> <span class="fl">0.49499</span>  <span class="fl">51.604</span> <span class="fl">0.00000</span></a>
<a class="sourceLine" id="cb4-43" data-line-number="43">intercept class2         <span class="fl">32.93897</span> <span class="fl">0.54794</span>  <span class="fl">60.115</span> <span class="fl">0.00000</span></a>
<a class="sourceLine" id="cb4-44" data-line-number="44"><span class="kw">I</span>(age <span class="op">-</span><span class="st"> </span>age_init) class1 <span class="fl">-0.51254</span> <span class="fl">0.05011</span> <span class="fl">-10.229</span> <span class="fl">0.00000</span></a>
<a class="sourceLine" id="cb4-45" data-line-number="45"><span class="kw">I</span>(age <span class="op">-</span><span class="st"> </span>age_init) class2 <span class="fl">-0.57198</span> <span class="fl">0.04883</span> <span class="fl">-11.714</span> <span class="fl">0.00000</span></a>
<a class="sourceLine" id="cb4-46" data-line-number="46"></a>
<a class="sourceLine" id="cb4-47" data-line-number="47"></a>
<a class="sourceLine" id="cb4-48" data-line-number="48">Variance<span class="op">-</span>covariance matrix of the random<span class="op">-</span>effects<span class="op">:</span></a>
<a class="sourceLine" id="cb4-49" data-line-number="49"><span class="st">                  </span>intercept <span class="kw">I</span>(age <span class="op">-</span><span class="st"> </span>age_init)</a>
<a class="sourceLine" id="cb4-50" data-line-number="50">intercept          <span class="fl">10.89147</span>                  </a>
<a class="sourceLine" id="cb4-51" data-line-number="51"><span class="kw">I</span>(age <span class="op">-</span><span class="st"> </span>age_init)   <span class="fl">0.03929</span>           <span class="fl">0.09386</span></a>
<a class="sourceLine" id="cb4-52" data-line-number="52"></a>
<a class="sourceLine" id="cb4-53" data-line-number="53">                             coef      Se</a>
<a class="sourceLine" id="cb4-54" data-line-number="54">Residual standard error<span class="op">:</span><span class="st">  </span><span class="fl">3.36817</span> <span class="fl">0.06754</span></a></code></pre></div>
<p>The models in objects mhlme2 and mhlme2perm are the same except for the permutation of the classes as shown with the cross-table:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="kw">xclass</span>(mhlme2perm,mhlme2)</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">   </a>
<a class="sourceLine" id="cb5-3" data-line-number="3">      <span class="dv">1</span>   <span class="dv">2</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4">  <span class="dv">1</span>   <span class="dv">0</span> <span class="dv">232</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5">  <span class="dv">2</span> <span class="dv">262</span>   <span class="dv">0</span></a></code></pre></div>
<p> </p>
</div>
<div id="how-to-make-predictions-on-external-data" class="section level1">
<h1>How to make predictions on external data?</h1>
<p>An object stemmed from a estimation function of lcmm package (hlme, lcmm, Jointlcmm, mpjlcmm) provides predictions on the data on which the model was estimated.</p>
<p>Different functions allows the same type of computations but on external data:</p>
<div id="classification-with-predictclass" class="section level3">
<h3>Classification with PredictClass</h3>
<p>predictClass function computes the posterior classification and the posterior class-membership probabilities from any latent class model estimated in package lcmm.</p>
<p>For instance, using the 2-class model estimated above, the posterior probabilities and classification can be computed for the newdata, here the data of the second subject of paquid dataset:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">predictClass</span>(mhlme2, <span class="dt">newdata=</span>paquid[<span class="dv">2</span><span class="op">:</span><span class="dv">6</span>,])</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">  ID class     prob1     prob2</a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="dv">1</span>  <span class="dv">2</span>     <span class="dv">1</span> <span class="fl">0.5508846</span> <span class="fl">0.4491154</span></a></code></pre></div>
<p> </p>
</div>
<div id="random-effects-with-predictre" class="section level3">
<h3>Random-effects with predictRE</h3>
<p>predictRE function computes the predicted random-effects of any model estimated within lcmm package for a new subject whose data (i.e., covariates and outcomes) are provided in newdata:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw">predictRE</span>(mhlme2, <span class="dt">newdata=</span>paquid[<span class="dv">2</span><span class="op">:</span><span class="dv">6</span>,])</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">  ID  intercept <span class="kw">I</span>(age <span class="op">-</span><span class="st"> </span>age_init)</a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="dv">6</span>  <span class="dv">2</span> <span class="fl">-0.9514829</span>       <span class="fl">-0.07391964</span></a></code></pre></div>
<p> </p>
</div>
<div id="predictions-of-outcomes-in-their-natural-scale-using-predicty-and-predictycond" class="section level3">
<h3>Predictions of outcomes in their natural scale using predictY and predictYcond</h3>
<p>predictY function provides by default the mean outcome value predicted for a profile of covariates (provided in newdata). This prediction (with marg=TRUE by default) is a marginal prediction.</p>
<p>Subject-specific predictions can be obtained only for hlme right now. In that case, it should be indicated option marg=FALSE and newdata should include the outcome data so that the predicted random-effects can be included.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">predss &lt;-<span class="st"> </span><span class="kw">predictY</span>(mhlme2, paquid[<span class="dv">2</span><span class="op">:</span><span class="dv">6</span>,], <span class="dt">marg=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">predss<span class="op">$</span>pred</a>
<a class="sourceLine" id="cb8-3" data-line-number="3">  ID  pred_ss pred_ss1 pred_ss2</a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="dv">2</span>  <span class="dv">2</span> <span class="fl">27.25200</span> <span class="fl">26.21337</span> <span class="fl">28.52597</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="dv">3</span>  <span class="dv">2</span> <span class="fl">25.96443</span> <span class="fl">25.05767</span> <span class="fl">27.07667</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="dv">4</span>  <span class="dv">2</span> <span class="fl">23.07531</span> <span class="fl">22.46442</span> <span class="fl">23.82463</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="dv">5</span>  <span class="dv">2</span> <span class="fl">16.73827</span> <span class="fl">16.77635</span> <span class="fl">16.69156</span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="dv">6</span>  <span class="dv">2</span> <span class="fl">14.93028</span> <span class="fl">15.15351</span> <span class="fl">14.65646</span></a></code></pre></div>
<p>Predictions of the outcomes can also be directly computed for a latent process value. This is useful when nonlinear link functions are used in the models. This is obtained with function predictYcond.</p>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
